.chapter(data-title='IVR Phone Tree')
  .step(data-file='IVRPhoneTree.Web/packages.config', data-mode='xml')
    :markdown
      ## About this application

      ![Extra Terrestrial Phone Home
      Service](//howtodocs.s3.amazonaws.com/logo-et-phone2.png)

      This [ASP.NET MVC](//www.asp.net/mvc) sample application is
      modeled after a typical call center experience, but with more [Reese's
      Pieces](//en.wikipedia.org/wiki/Reese%27s_Pieces#ET:_The_Extra-
      Terrestrial).

      Stranded aliens can call a phone number and receive instructions on how
      to get out of earth safely, or call their home planet
      directly[.](//bit.ly/asogi) In this tutorial, we'll show you the
      key bits of code to make this work.

      To run this sample app yourself, [download the code and follow the
      instructions on GitHub](//github.com/TwilioDevEd/ivr-phone-tree-
      csharp).

      Let's get started! Click the right arrow above to move to the next step
      of the tutorial.

      ---

      **See Also:**
      * [Getting Started with ASP.NET MVC
      5](//www.asp.net/mvc/overview/getting-started/introduction/getting-started)
      * [The Twilio C# Helper Library](//www.twilio.com/docs/csharp/install)

  .step(data-file='IVRPhoneTree.Web/packages.config', data-mode='xml')
    :markdown
      ## Respond to the Phone Call

      To initiate the phone tree, we need to configure one of our Twilio
      numbers to send our web application an HTTP request when we
      get an incoming call.

      [Click on one of your
      numbers](//www.twilio.com/user/account/phone-numbers/incoming) and
      configure the Voice URL to point to our app. In our code the route
      will be `/ivr/welcome`.

      ![Configuring a Twilio Number](//s3.amazonaws.com/howtodocs/number-
      config.png)

      ---

      **See Also:**
      * [Configuring Twilio Numbers for
      Voice](//www.twilio.com/help/faq/voice/how-do-i-assign-my-twilio-number-to-my-voice-application)
      * [Using ngrok to test your Twilio webhooks locally](//www.twilio.com/blog/2013/10/test-your-webhooks-locally-with-ngrok.html)

  .step(data-file='IVRPhoneTree.Web/Controllers/IVRController.cs',
  data-highlight='15-25')
    :markdown
      ## Respond to the Twilio request with TwiML

      Our Twilio number is now configured to [send HTTP
      requests](//www.twilio.com/docs/api/twiml/twilio_request) to this
      controller action on any incoming voice calls. Our app responds with
      [TwiML](//www.twilio.com/docs/api/twiml) to tell Twilio what to do
      in response to the message.

      In this case we tell Twilio to
      [`Gather`](//www.twilio.com/docs/api/twiml/gather) the input from
      the caller and we [`Play`](//www.twilio.com/docs/api/twiml/play) a
      welcome message.

      ---

      **See Also:**
      * [Gather attributes](//www.twilio.com/docs/api/twiml/gather#attributes)
      * [Play 'loop' attribute](//www.twilio.com/docs/api/twiml/play#attributes-loop)
      * [Twilio Helpers for ASP.NET
      MVC](//github.com/twilio/twilio-csharp/wiki/Twilio.Mvc)
      * [Twilio for .NET Developers Part
      5](//www.twilio.com/blog/2012/02/twilio-for-net-developers-part-5-twilio-client-mvc-and-webmatrix-helper-libraries.html)

  .step(data-file='IVRPhoneTree.Web/Controllers/IVRController.cs',
  data-highlight='20')
    :markdown
      ## Where to send the caller's input

      The *gather's* `action` parameter takes an absolute or relative URL as a
      value - in our case, the `/ivr/selection` route.

      When the caller has finished entering digits Twilio will make a
      GET or POST request to this URL including a
      [`Digits`](//www.twilio.com/docs/api/twiml/gather#attributes-
      action-parameters) parameter with the number our caller chose.

      After making this request, Twilio will continue the current call using
      the TwiML received in your response. Any TwiML verbs occuring after a
      `<Gather>` are unreachable, unless the caller enters no digits.

      ---

      **See Also:**
      * [Twilio Request
        parameters](//www.twilio.com/docs/api/twiml/twilio_request
        #synchronous-request-parameters)

  .step(data-file='IVRPhoneTree.Web/Controllers/MenuController.cs',
  data-highlight='11-42')
    :markdown
      ## The Main Menu: Process the caller's selection

      This route handles processing the caller's input.

      If our caller chooses '1' for directions, we use a helper method defined
      below, `ReturnInstructions`, to respond with TwiML that will
      [`Say`](//www.twilio.com/docs/api/twiml/say) directions to our
      caller's extraction point.

      If the caller chooses '2' to call her home planet, then we need to
      gather more input from her. We'll cover this in the next step.

      If the caller enters anything else we respond with a TwiML
      [`Redirect`](//www.twilio.com/docs/api/twiml/redirect) to the main
      menu.

      ---

      **See Also:**
      * [ActionNameAttribute
      Class](//msdn.microsoft.com/en-us/library/system.web.mvc.actionnameattribute.aspx)
      * [switch (C# Reference)](//msdn.microsoft.com/en-us/library/06tc147t.aspx)
      * [The TwiML Hangup verb](//www.twilio.com/docs/api/twiml/hangup)
      * [TwiMl Say: Language Options](//www.twilio.com/docs/api/twiml/say#attributes-alice)

  .step(data-file='IVRPhoneTree.Web/Controllers/MenuController.cs',
  data-highlight='44-55')
    :markdown
      ## The Planet Directory: Collect more input from the caller

      If our caller chooses to call her home planet we will tell her the planet
      directory. This is akin to a typical "company directory" feature of
      most IVRs.

      In our TwiML response we again use a `Gather` verb to receive our caller's
      input. The `action` verb points this time to the `planets` route, which
      will switch our response based on what the caller chooses.

      Let's look at that route next.

  .step(data-file='IVRPhoneTree.Web/Controllers/PhoneExchangeController.cs',
  data-highlight='10-32')
    :markdown
      ## The Planet Directory: Connect the caller to another number

      In this route, we grab the caller's selection off the request and store
      it in a variable called `userOption`. We then use a
      [`Dial`](https://www.twilio.com/docs/api/twiml/dial) verb with
      the appropriate phone number to connect our caller to her home
      planet.

      The current numbers are hardcoded, but they could also be
      read from a database or from a file.

  .step
    :markdown
      ## Where to next?

      That's it! We've just implemented an IVR phone tree that will delight
      and serve your customers.

      If you're a C# developer working with Twilio, you might enjoy these
      other tutorials:

      [**Automated
      Survey**](//www.twilio.com/docs/howto/walkthrough/automated-survey/csharp/mvc)

      Instantly collect structured data from your users with a survey
      conducted over a voice call or SMS text messages. Learn how to create
      your own survey in ASP.NET MVC.

      [**Call
      Tracking**](//www.twilio.com/docs/howto/walkthrough/call-tracking/csharp/mvc)

      Convert web traffic into phone calls with the click of a button.

      ### Did this help?

      Thanks for checking out this tutorial! If you have any feedback to share
      with us, we'd love to hear it. Tweet
      [@twilio](//twitter.com/twilio) to let us know what you think.
